@using Mantle.Plugins.Widgets.Bootstrap3.ContentBlocks
@model Mantle.Plugins.Widgets.Bootstrap3.ContentBlocks.Bootstrap3ImageGalleryBlock

@inject Mantle.Web.IWorkContext WorkContext

<div id="block-content">
    <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="form-group">
            @Html.LabelFor(m => m.MediaFolder, new { @class = "col-xs-12 col-sm-4 col-md-3 col-lg-3" })
            <div class="col-xs-12 col-sm-8 col-md-9 col-lg-9">
                <div class="input-group">
                    @Html.TextBoxFor(m => m.MediaFolder, new { @class = "form-control" })
                    @*@Html.TextBoxFor(m => m.MediaFolder, new { @class = "form-control", data_bind = "value: blockModel.mediaFolder" })*@
                    <span class="input-group-addon">
                        <a data-toggle="modal" href="javascript:void(0);" data-target="#myModal">
                            <i class="fa fa-search"></i>
                        </a>
                    </span>
                </div>
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.ImagesPerRowXS, new { @class = "col-xs-12 col-sm-4 col-md-3 col-lg-3" })
            <div class="col-xs-12 col-sm-8 col-md-9 col-lg-9">
                @Html.DropDownListFor(m => m.ImagesPerRowXS, Html.GetEnumSelectList<Bootstrap3ImageGalleryBlock.ImagesPerRow>(), new { @class = "form-control", data_bind = "value: blockModel.imagesPerRowXS" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.ImagesPerRowS, new { @class = "col-xs-12 col-sm-4 col-md-3 col-lg-3" })
            <div class="col-xs-12 col-sm-8 col-md-9 col-lg-9">
                @Html.DropDownListFor(m => m.ImagesPerRowS, Html.GetEnumSelectList<Bootstrap3ImageGalleryBlock.ImagesPerRow>(), new { @class = "form-control", data_bind = "value: blockModel.imagesPerRowS" })
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
        <div class="form-group">
            @Html.LabelFor(m => m.ImagesPerRowM, new { @class = "col-xs-12 col-sm-4 col-md-3 col-lg-3" })
            <div class="col-xs-12 col-sm-8 col-md-9 col-lg-9">
                @Html.DropDownListFor(m => m.ImagesPerRowM, Html.GetEnumSelectList<Bootstrap3ImageGalleryBlock.ImagesPerRow>(), new { @class = "form-control", data_bind = "value: blockModel.imagesPerRowM" })
            </div>
        </div>
        <div class="form-group">
            @Html.LabelFor(m => m.ImagesPerRowL, new { @class = "col-xs-12 col-sm-4 col-md-3 col-lg-3" })
            <div class="col-xs-12 col-sm-8 col-md-9 col-lg-9">
                @Html.DropDownListFor(m => m.ImagesPerRowL, Html.GetEnumSelectList<Bootstrap3ImageGalleryBlock.ImagesPerRow>(), new { @class = "form-control", data_bind = "value: blockModel.imagesPerRowL" })
            </div>
        </div>
    </div>

    <style type="text/css">
        .modal-dialog {
            width: 80% !important;
        }
    </style>

    <div class="modal fade" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" onclick="dismissModal();" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Select Folder</h4>
                </div>
                <div class="modal-body">
                    @Html.Mantle().FileManager("MediaFolder", WorkContext.CurrentTenant.Id, FileFilterMode.Folder)
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    let modalDismissed = false;

    function dismissModal() {
        modalDismissed = true;
        $('#myModal').modal('hide');
    };

    $(document).ready(function () {
        $('#myModal').on('hidden.bs.modal', function () {
            if (!modalDismissed) {
                let url = $('#MediaFolder').val();
                const idx = url.indexOf("Uploads");
                url = url.substring(idx);
                $('#MediaFolder').val(url);
                //blockModel.mediaFolder(url);
            }
            modalDismissed = false;
        });
    });

    @Model.RenderKOScript()
</script>